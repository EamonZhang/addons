credential:
  - name: HOST
    valueFrom:
      serviceRef:
        name: {{ include "common.names.fullname" . }}
        jsonpath: '{ .status.loadBalancer.ingress[*].ip }'

  {{- if or (.Values.service.portEnabled) (not .Values.auth.tls.enabled) }}
  - name: RABBITMQ_AMQP_PORT
    valueFrom:
      serviceRef:
        name: {{ include "common.names.fullname" . }}
        jsonpath: '{ .spec.ports[?(@.targetPort=="amqp")].port }'
  {{- end }}

  {{- if .Values.auth.tls.enabled }}
  - name: RABBITMQ_AMQP_SSL_PORT
    valueFrom:
      serviceRef:
        name: {{ include "common.names.fullname" . }}
        jsonpath: '{ .spec.ports[?(@.targetPort=="amqp-ssl")].port }'
  {{- end }}

  {{- if .Values.service.epmdPortEnabled }}
  - name: RABBITMQ_EPMD_PORT
    valueFrom:
      serviceRef:
        name: {{ include "common.names.fullname" . }}
        jsonpath: '{ .spec.ports[?(@.targetPort=="epmd")].port }'
  {{- end }}

  {{- if .Values.service.managerPortEnabled }}
  - name: RABBITMQ_STATS_PORT
    valueFrom:
      serviceRef:
        name: {{ include "common.names.fullname" . }}
        jsonpath: '{ .spec.ports[?(@.targetPort=="stats")].port }'
  {{- end }}

  {{- if .Values.service.distPortEnabled }}
  - name: RABBITMQ_DIST_PORT
    valueFrom:
      serviceRef:
        name: {{ include "common.names.fullname" . }}
        jsonpath: '{ .spec.ports[?(@.targetPort=="dist")].port }'
  {{- end }}

  {{- if .Values.auth.username }}
  - name: RABBITMQ_USER
    value: {{ .Values.auth.username | quote }}
  {{- end }}

  {{- if or (not .Values.auth.existingErlangSecret) (not .Values.auth.existingPasswordSecret) }}
  {{- if (not .Values.auth.existingPasswordSecret ) }}
  - name: RABBITMQ_PASSWORD
    valueFrom:
      secretKeyRef:
        name: {{ include "common.names.fullname" . }}
        jsonpath: '{ .data.rabbitmq-password }'
  {{- end }}
  {{- if (not .Values.auth.existingErlangSecret ) }}
  - name: RABBITMQ_ERLANG_COOKIE
    valueFrom:
      secretKeyRef:
        name: {{ include "common.names.fullname" . }}
        jsonpath: '{ .data.rabbitmq-erlang-cookie }'
  {{- end }}
  {{- end }}